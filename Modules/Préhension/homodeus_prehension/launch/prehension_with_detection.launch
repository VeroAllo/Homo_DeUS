<?xml version="1.0" encoding="UTF-8"?>
<launch>
  <arg name="namespace"       default="/"/>
  <arg name="public_sim"      default="true"/>

  <!-- robot parameters -->
  <arg name="arm"             default="true"/>
  <arg name="base_type"       default="pmb2"/>
  <arg name="camera_model"    default="orbbec-astra"/>
  <arg name="end_effector"    default="pal-gripper"/>
  <arg name="ft_sensor"       default="schunk-ft"/>
  <arg name="laser_model"     default="sick-571"/>
  <arg name="robot"           default="titanium"/>

  <!-- gazebo parameters -->
  <arg name="world"           default="3it_P2_Closer"/>

  <arg name="gzclient"        default="true"/>
  <arg name="gzpose"          default="-x 0.0  -y   0.0 -z  0.0   -R 0.0 -P 0.0 -Y  0.0"/>

  <arg name="extra_gazebo_args" default=""/>

  <!-- planif parameters -->
  <arg name="planner"         default="base"/>
  <arg name="global_planner"  default="global_planner"/>
  <arg name="local_planner"   default="$(eval 'teb' if (arg('public_sim') or arg('base_type')=='omni_base') else 'pal')"/>
  <arg name="localization"    default="amcl"/>
  <arg name="map"             default="$(env HOME)/.pal/tiago_maps/configurations/$(arg world)"/>
  
  <!-- Object segmentation -->
  <arg name="rate"                default="1"                               />
  <arg name="cloud"               default="/xtion/depth_registered/points"  />
  <arg name="frame"               default="base_link"                       />
  <arg name="passthrough_axis"    default="z"                               />
  <arg name="passthrough_min"     default="0.4"                             />
  <arg name="passthrough_max"     default="1.6"                             />
  <arg name="downsampling_size"   default="0.01"                            />
  <arg name="objs"  			        default="segment_table/nonplane"          />

  <!-- -->
  <arg name="recording"           default="false"/>
  <arg name="rviz"                default="true"/>

  <!-- scripts flags -->
  <arg name="tuck_arm"            default="true"/>
  <arg name="vision_detection"    default="true"/>
 
  <!-- <env name="PAL_HOST" value="tiago" /> -->

  <group ns="$(arg namespace)">

    <include file="$(find tiago_gazebo)/launch/tiago_gazebo.launch" if="$(arg public_sim)">
      <arg name="world"             value="$(arg world)"/>
      <arg name="arm"               value="$(arg arm)"/>
      <arg name="base_type"         value="$(arg base_type)"/>
      <arg name="camera_model"      value="$(arg camera_model)"/>
      <arg name="end_effector"      value="$(arg end_effector)"/>
      <arg name="ft_sensor"         value="$(arg ft_sensor)"/>
      <arg name="gui"               value="$(arg gzclient)"/>
      <arg name="gzpose"            value="$(arg gzpose)"/>
      <arg name="laser_model"       value="$(arg laser_model)"/>
      <arg name="public_sim"        value="$(arg public_sim)"/>
      <arg name="recording"         value="$(arg recording)"/>
      <arg name="tuck_arm"          value="$(arg tuck_arm)"/>
      <arg name="extra_gazebo_args" value="$(arg extra_gazebo_args)"/>
      <arg if="$(eval local_planner == 'teb')" name="use_dynamic_footprint" value="true"/>
    </include>

    <!-- Commentaire, car la carte du monde "3iT_P2_Closer" n'existe propablement pas -->
    <!-- Cependant, en l'activant, cela réglerait le problème du référentiel /map inexistant -->
    <!-- <include file="$(find tiago_2dnav_gazebo)/launch/navigation.launch" if="$(arg public_sim)">
      <arg name="state"             value="localization"/>
      <arg name="planner"           value="$(arg planner)"/>
      <arg name="global_planner"    value="$(arg global_planner)"/>
      <arg name="local_planner"     value="$(arg local_planner)"/>
      <arg name="localization"      value="$(arg localization)"/>
      <arg name="map"               value="$(arg map)"/>
      <arg name="public_sim"        value="$(arg public_sim)"/>
      <arg name="rgbd_sensors"      value="false"/>
      <arg name="laser_model"       value="$(arg laser_model)"/>
      <arg name="base_type"         value="$(arg base_type)"/>
    </include> -->

    <include file="$(find homodeus_prehension)/launch/object_segmentation.launch">
      <arg name="rate"                   value="$(arg rate)"/>
      <arg name="cloud"                  value="$(arg cloud)"/>
      <arg name="frame"                  value="$(arg frame)"/>
      <arg name="passthrough_axis"       value="$(arg passthrough_axis)"/>
      <arg name="passthrough_min"        value="$(arg passthrough_min)"/>
      <arg name="passthrough_max"        value="$(arg passthrough_max)"/>
      <arg name="downsampling_size"      value="$(arg downsampling_size)"/>
      <arg name="show_rviz"              value="$(arg rviz)"/>
      <arg name="objs"                   value="$(arg objs)"/>
    </include>

    <node name="arm_interface_node" pkg="homodeus_prehension" type="arm_interface_node"
      respawn="false" output="screen" launch-prefix="gnome-terminal --command"/>

    <node name="pseudo_detection" pkg="pseudo_detection" type="pseudo_detection" if="$(arg vision_detection)"
      respawn="false" output="screen" launch-prefix="gnome-terminal --command"/>
  </group>

</launch>
